"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[6742],{5680:(e,t,n)=>{n.d(t,{xA:()=>c,yg:()=>m});var a=n(6540);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var p=a.createContext({}),l=function(e){var t=a.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},c=function(e){var t=l(e.components);return a.createElement(p.Provider,{value:t},e.children)},u="mdxType",h={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,p=e.parentName,c=o(e,["components","mdxType","originalType","parentName"]),u=l(n),d=r,m=u["".concat(p,".").concat(d)]||u[d]||h[d]||i;return n?a.createElement(m,s(s({ref:t},c),{},{components:n})):a.createElement(m,s({ref:t},c))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,s=new Array(i);s[0]=d;var o={};for(var p in t)hasOwnProperty.call(t,p)&&(o[p]=t[p]);o.originalType=e,o[u]="string"==typeof e?e:r,s[1]=o;for(var l=2;l<i;l++)s[l]=n[l];return a.createElement.apply(null,s)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},2167:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>s,default:()=>h,frontMatter:()=>i,metadata:()=>o,toc:()=>l});var a=n(8168),r=(n(6540),n(5680));const i={sidebar_position:1},s="Installation",o={unversionedId:"sesami-apps/api-reference/installation-api",id:"sesami-apps/api-reference/installation-api",title:"Installation",description:"The installation flow follows the OAuth 2.0 flow. In this flow, Sesami acts as the Authorization Server (Protected Resource), the app is the Client, and the merchant is the Resource Owner. This document outlines how to execute the OAuth flow from the app's perspective.",source:"@site/docs/5-sesami-apps/4-api-reference/installation-api.md",sourceDirName:"5-sesami-apps/4-api-reference",slug:"/sesami-apps/api-reference/installation-api",permalink:"/docs/sesami-apps/api-reference/installation-api",draft:!1,editUrl:"https://github.com/sesamiapp/devportal/edit/master/docs/5-sesami-apps/4-api-reference/installation-api.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1},sidebar:"tutorialSidebar",previous:{title:"App Loading Flow",permalink:"/docs/sesami-apps/how-it-works/loading-flow"},next:{title:"Quick Setup",permalink:"/docs/sesami-apps/api-reference/app-message/quick-setup"}},p={},l=[{value:"Authenticate the requests",id:"authenticate-the-requests",level:3},{value:"Step 1 : Send an authorization request",id:"step-1--send-an-authorization-request",level:3},{value:"Step 2 : Request an Offline Token",id:"step-2--request-an-offline-token",level:3}],c={toc:l},u="wrapper";function h(e){let{components:t,...n}=e;return(0,r.yg)(u,(0,a.A)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,r.yg)("h1",{id:"installation"},"Installation"),(0,r.yg)("p",null,"The installation flow follows the OAuth 2.0 flow. In this flow, Sesami acts as the Authorization Server (Protected Resource), the app is the Client, and the merchant is the Resource Owner. This document outlines how to execute the OAuth flow from the app's perspective."),(0,r.yg)("p",null,"Before proceeding, ensure that you have registered your app. See ",(0,r.yg)("a",{parentName:"p",href:"/docs/sesami-apps/register-application"},"Register an App")," for more details."),(0,r.yg)("h3",{id:"authenticate-the-requests"},"Authenticate the requests"),(0,r.yg)("p",null,"The app must authenticate incoming requests. Sesami sends requests with an ",(0,r.yg)("inlineCode",{parentName:"p"},"hmac")," property, which the app should use to verify the authenticity of the requests."),(0,r.yg)("p",null,"The ",(0,r.yg)("inlineCode",{parentName:"p"},"hmac")," is a string that signs the requests. The app must sign the request parameters using its ",(0,r.yg)("inlineCode",{parentName:"p"},"client_secret")," and validate the result against the ",(0,r.yg)("inlineCode",{parentName:"p"},"hmac"),"."),(0,r.yg)("p",null,"Here is the process:"),(0,r.yg)("ol",null,(0,r.yg)("li",{parentName:"ol"},"Create an object with the request's parameters, excluding the hmac parameter."),(0,r.yg)("li",{parentName:"ol"},"Sort the object's keys alphabetically.\nFor example, consider the following request:")),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-typescript"},"https://your-app-domian?code=string&shopId=string&timestamp=string&hmac=string\n")),(0,r.yg)("p",null,"The app should generate this object:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-typescript"},"{\n  code: string,\n  shopId: string\n  timestamp: string\n}\n")),(0,r.yg)("p",null,"Then, the app should encrypt this object using the ",(0,r.yg)("inlineCode",{parentName:"p"},"sha256")," algorithm along with its ",(0,r.yg)("inlineCode",{parentName:"p"},"client_secret")," and compare the result with the provided ",(0,r.yg)("inlineCode",{parentName:"p"},"hmac")," to verify the request."),(0,r.yg)("h3",{id:"step-1--send-an-authorization-request"},"Step 1 : Send an authorization request"),(0,r.yg)("p",null,"To initiate the OAuth flow, the app sends a request to the authorization endpoint. The endpoint is:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-HTTPS"},"https://api.sesami.co/api/v1/oauth/authorization?clientId=string&scopes[]=string&redirectUri=string&shopId=string\n")),(0,r.yg)("admonition",{type:"info"},(0,r.yg)("p",{parentName:"admonition"},(0,r.yg)("inlineCode",{parentName:"p"},"scopes"),": These are the required permissions. They should be sent in the format: ",(0,r.yg)("inlineCode",{parentName:"p"},"scopes[]=Shop:Read"),"."),(0,r.yg)("p",{parentName:"admonition"},"Our platform support Read-only permission at this time.")),(0,r.yg)("p",null,"This endpoint redirects the user to the Sesami consent page, where the user decides whether to accept or deny your requested permissions. If the user accepts, Sesami sends an authorization code to your specified redirect URI.\nThe callback URL format is:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-typescript"},"https://your-app-domain/your-callback-url?code=string&shopId=string&timestamp=string&hmac=string\n")),(0,r.yg)("h3",{id:"step-2--request-an-offline-token"},"Step 2 : Request an Offline Token"),(0,r.yg)("p",null,"After receiving the authorization code, you can use it along with your ",(0,r.yg)("inlineCode",{parentName:"p"},"client_id")," and ",(0,r.yg)("inlineCode",{parentName:"p"},"client_secret")," to obtain an offline token."),(0,r.yg)("admonition",{type:"note"},(0,r.yg)("p",{parentName:"admonition"},"The app must obtain an offline token for each shop.")),(0,r.yg)("p",null,"To request the offline token, send a request to the following endpoint:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-typescript"},"https://api.sesami.co/api/v1/oauth/access-token\n")),(0,r.yg)("p",null,"With the following body:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-typescript"},"{\n code: string //your authorization code\n shopId: string\n clientId: string\n clientId: string\n}\n")),(0,r.yg)("p",null,"the response is like:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-typescript"},' {\n   token: "YOUR_TOKEN"\n   clientId: "YOUR_CLIENT_ID";\n   expireAt: "NEVER";\n   name: string;\n }\n')))}h.isMDXComponent=!0}}]);